name: Deploy Docs to GitHub Pages

on:
    push:
        branches:
            - main
    pull_request:
    workflow_dispatch:

env:
  CARGO_TERM_COLOR: always
  WAYLYRICS_THEME_PRESETS_DIR: /usr/share/waylyrics/themes

jobs:
    release:
        name: GitHub Pages
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v3

            - name: Install Rust toolchain
              uses: actions-rs/toolchain@v1
              with:
                toolchain: nightly
                profile: minimal
                override: true
                components: rustfmt, rust-src

            
            - name: Install deps
              run: |
                sudo apt update
                sudo apt install -y --no-install-recommends libgtk-4-dev libdbus-1-dev pkg-config

            - name: Build Documentation
              uses: actions-rs/cargo@v1
              with:
                command: doc
                args: --all --no-deps
            
            - name: Deploy Documentation
              uses: peaceiris/actions-gh-pages@v3
              with:
                  github_token: ${{ secrets.ACTIONS_DEPLOY_KEY }}
                  publish_dir: ./targeut/doc
